import numpy as np
import matplotlib.pyplot as plt

# ==============================
# ФИЗИЧЕСКИЕ ПАРАМЕТРЫ
# ==============================
g = 9.81              # м/с^2
rho0 = 1025.0         # плотность воды, кг/м^3
rho1 = 900.0          # средняя плотность подлодки, кг/м^3
k = 150.0             # коэффициент сопротивления, кг/с
H = 100.0             # начальная глубина, м
v = 5.0               # горизонтальная скорость, м/с

# ==============================
# МАСШТАБИРОВАНИЕ
# ==============================
T = np.sqrt(H * rho1 / (g * (rho0 - rho1)))
beta = (k / rho1) * T

# ==============================
# ЧИСЛЕННЫЕ ПАРАМЕТРЫ
# ==============================
dt = 0.01             # безразмерный шаг времени
max_steps = 100000

# ==============================
# НАЧАЛЬНЫЕ УСЛОВИЯ
# ==============================
t = 0.0
h = 0.0               # безразмерная высота
u = 0.0               # безразмерная скорость

# ==============================
# МАССИВЫ ДЛЯ ХРАНЕНИЯ
# ==============================
t_arr = []
h_arr = []
u_arr = []
l_arr = []

# ==============================
# ОСНОВНОЙ ЦИКЛ ЭЙЛЕРА
# ==============================
for _ in range(max_steps):
    t_arr.append(t)
    h_arr.append(h)
    u_arr.append(u)
    l_arr.append(t)   # \tilde{l} = \tilde{t}

    if h >= 1.0:      # всплытие на поверхность
        break

    # схема Эйлера
    h_new = h + dt * u
    u_new = u + dt * (1.0 - beta * u)

    h, u = h_new, u_new
    t += dt

# ==============================
# ПЕРЕХОД К РАЗМЕРНЫМ ВЕЛИЧИНАМ
# ==============================
t_arr = np.array(t_arr) * T
h_arr = np.array(h_arr) * H
u_arr = np.array(u_arr) * (H / T)
l_arr = np.array(l_arr) * v * T

# ==============================
# ГРАФИКИ
# ==============================
plt.figure()
plt.plot(t_arr, h_arr)
plt.xlabel("t, с")
plt.ylabel("h, м")
plt.title("Всплытие подводной лодки")
plt.grid()

plt.figure()
plt.plot(t_arr, u_arr)
plt.xlabel("t, с")
plt.ylabel("v_h, м/с")
plt.title("Вертикальная скорость")
plt.grid()

plt.figure()
plt.plot(l_arr, h_arr)
plt.xlabel("l, м")
plt.ylabel("h, м")
plt.title("Траектория движения подлодки")
plt.grid()

plt.show()

# ==============================
# ИНФОРМАЦИЯ О РАСЧЁТЕ
# ==============================
print(f"Время всплытия: {t_arr[-1]:.2f} с")
print(f"Горизонтальное смещение: {l_arr[-1]:.2f} м")
print(f"Предельная вертикальная скорость: {1/beta * H / T:.2f} м/с")
